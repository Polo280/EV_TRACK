#ifndef GLOBALS_H
#define GLOBALS_H

#include "esp_log.h"
#include "freertos/FreeRTOS.h"
#include "freertos/semphr.h"
#include <stdio.h>
#include <string.h>
#include "driver/uart.h"
#include "esp_adc/adc_oneshot.h"
#include "esp_netif.h"
#include "esp_system.h"
#include "esp_event.h"
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "driver/gpio.h"

/////////////////////////////////////////////////////////
///////////////////// BOARD PINOUT //////////////////////
/////////////////////////////////////////////////////////

// GPIOs
#define LED_PIN                       GPIO_NUM_12
#define TEST_EN_BUTTON_PIN            GPIO_NUM_13
#define SD_DETECT_PIN                 GPIO_NUM_4

// GPS UART 
#define GPS_UART_CHANNEL              UART_NUM_1
#define GPS_RX_GPIO                   GPIO_NUM_14
#define GPS_TX_GPIO                   GPIO_NUM_15

// DRIVER UART
#define FOC_DRIVER_UART_CHANNEL       UART_NUM_0
#define FOC_DRIVER_RX_GPIO            GPIO_NUM_3
#define FOC_DRIVER_TX_GPIO            GPIO_NUM_1
#define FOC_DRIVER_BAUDRATE           115200

// I2C Bus
#define I2C_INSTANCE                  I2C_NUM_0
#define I2C_SDA                       GPIO_NUM_21
#define I2C_SCL                       GPIO_NUM_22
#define I2C_FREQ_HZ                   50000 

// SPI Bus
#define SPI_MISO_PIN                  GPIO_NUM_19
#define SPI_MOSI_PIN                  GPIO_NUM_23
#define SPI_CLK_PIN                   GPIO_NUM_18
#define SD_SPI_CS_PIN                 GPIO_NUM_26     // Micro SD
#define RF_SPI_CS_PIN                 GPIO_NUM_25
 

//////////////////////////////////////////////////////////

// PLATFORM STATUS CODES
typedef enum {
    STATUS_ONLINE,
    STATUS_OFFLINE,
    STATUS_TRANSMITTING,
    STATUS_ERROR
} STATUS_CODES;


// Control variables
extern uint8_t current_status_code;
extern bool test_mode_enabled;
extern bool GPS_fix_status; 
extern volatile bool SD_card_detected; 
extern bool isRunning;


// TELEMETRY DATA TEMPLATE
typedef struct {
    uint32_t timestamp;
    float battery_voltage;
    float current_amps;
    double latitude;
    double longitude;
    float accel_x;
    float accel_y;
    float accel_z;
    float orient_x;
    float orient_y;
    float orient_z;
    uint16_t rpms;
    float velocity_x;
    float velocity_y;
    float ambient_temp;
    float altitude_m;
    uint8_t num_sats;
    float air_speed;
    uint16_t throttle_raw;
} TelemetryData;


// TRACK VARIABLES 
#define SPEEDWAY_TRACK

#ifdef SPEEDWAY_TRACK
    #define ORIGIN_LONGITUDE_COORD  -86.238859    // Adjust later
    #define ORIGIN_LATITUDE_COORD    39.793157
#endif  


// Telemetry Struct to store current Data
extern TelemetryData telemetry_data;

// Mutexes
extern SemaphoreHandle_t telemetry_mutex;
extern SemaphoreHandle_t i2c_mutex;

#endif /* GLOBALS_H */